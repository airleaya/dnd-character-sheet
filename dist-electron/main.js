"use strict";const c=require("electron"),o=require("path"),t=require("fs"),a=o.join(process.cwd(),"saves");t.existsSync(a)||t.mkdirSync(a,{recursive:!0});let s=null,l=!1;const u=()=>{s=new c.BrowserWindow({width:1280,height:800,webPreferences:{preload:o.join(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1}}),process.env.VITE_DEV_SERVER_URL?s.loadURL(process.env.VITE_DEV_SERVER_URL):s.loadFile("dist/index.html"),s.on("close",n=>{l||(n.preventDefault(),s?.webContents.send("app-will-close"),setTimeout(()=>{l||(l=!0,s?.close())},3e3))})};c.app.whenReady().then(()=>{u(),c.ipcMain.handle("save-character",async(n,i,e)=>{try{const r=o.join(a,i);return t.writeFileSync(r,e,"utf-8"),console.log("âœ… Saved:",r),{success:!0}}catch(r){return console.error("Save Error:",r),{success:!1,error:r}}}),c.ipcMain.handle("load-all-characters",async()=>{try{return{success:!0,data:t.readdirSync(a).filter(e=>e.endsWith(".json")).map(e=>{try{const r=t.readFileSync(o.join(a,e),"utf-8");return JSON.parse(r)}catch{return null}}).filter(Boolean)}}catch(n){return{success:!1,error:n}}}),c.ipcMain.handle("delete-character",async(n,i)=>{try{const e=o.join(a,i);return t.existsSync(e)&&t.unlinkSync(e),{success:!0}}catch(e){return{success:!1,error:e}}}),c.ipcMain.handle("app-can-close",()=>{l=!0,s?.close()})});
