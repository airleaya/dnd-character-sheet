# Project Context Index V8

Generated: 2026/1/29 01:52:57

- **ğŸ“¦ src/**
  - **ğŸ“‚ components/**
    - **ğŸ“‚ common/**
      - **ğŸ“„ EditableText.vue**
          - *Props:* `{ modelValue: string | number; // æ¥æ”¶ç»‘å®šçš„å€¼ width?: string; // å¯é€‰ï¼šæ§åˆ¶å®½åº¦ }`
          - *Emits:* `['update:modelValue', 'change']`
      - **ğŸ“„ EditableTextarea.vue**
          - *Props:* `{ modelValue: string; placeholder?: string; rows?: number; // é»˜è®¤è¡Œæ•° }`
          - *Emits:* `['update:modelValue', 'change']`
    - **ğŸ“‚ layout/**
      - **ğŸ“„ AppLayout.vue**
      - **ğŸ“„ SidebarLeft.vue**
          - *Uses:* `useCharacterStore, useActiveSheetStore`
      - **ğŸ“„ SidebarRight.vue**
    - **ğŸ“‚ sheet/**
      - **ğŸ“„ ActionsPanel.vue**
          - *Uses:* `useActiveSheetStore, useTooltipStore`
      - **ğŸ“„ BioPanel.vue**
          - *Props:* `{ isOpen: boolean }`
          - *Emits:* `['close']`
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ CombatPanel.vue**
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ EquipmentSlots.vue**
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ ForgeModal.vue**
      - **ğŸ“„ HeaderInfo.vue**
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ InventoryItemRow.vue**
          - *Props:* `{ item: any; // å½“å‰ç‰©å“å¯¹è±¡ }`
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ InventoryPanel.vue**
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ LibraryItemsPanel.vue**
          - *Props:* `{ searchQuery: string; }`
          - *Emits:* `{ (e: 'hover-item', item: any, event: MouseEvent`
      - **ğŸ“„ LibrarySpellsPanel.vue**
          - *Props:* `{ searchQuery: string; }`
          - *Emits:* `{ (e: 'hover-item', item: any, event: MouseEvent`
      - **ğŸ“„ ProficiencySettingsModal.vue**
          - *Props:* `{ isOpen: boolean; }`
          - *Emits:* `['close']`
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ SpellbookPanel.vue**
          - *Props:* `{ isOpen: boolean; }`
          - *Emits:* `['close']`
          - *Uses:* `useActiveSheetStore`
      - **ğŸ“„ StatsAndSkills.vue**
          - *Uses:* `useActiveSheetStore, useCharacterStore`
      - **ğŸ“„ TrashPanel.vue**
          - *Uses:* `useActiveSheetStore`
    - **ğŸ“‚ sidebar/**
      - **ğŸ“„ ForgeDropZone.vue**
      - **ğŸ“„ LibraryTooltip.vue**
          - *Props:* `{ item: any; position: { x: number; y: number }; type: 'item' | 'spell'; // æ˜¾å¼åŒºåˆ†ç±»å‹ }`
    - **ğŸ“‚ ui/**
      - **ğŸ“„ GlobalTooltip.vue**
          - *Uses:* `useTooltipStore`
  - **ğŸ“‚ composables/**
    - **ğŸ“„ useForge.ts**
        - *Exports:* `useForge`
    - **ğŸ“„ useLibraryFilter.ts**
        - *Exports:* `useLibraryFilter`
  - **ğŸ“‚ data/**
    - **ğŸ“‚ libraries/**
      - **ğŸ“„ armors.ts**
          - *Exports:* `ARMOR_LIBRARY`
      - **ğŸ“„ consumables.ts**
          - *Exports:* `CONSUMABLE_LIBRARY`
      - **ğŸ“„ containers.ts**
          - *Exports:* `CONTAINER_LIBRARY`
      - **ğŸ“„ gears.ts**
          - *Exports:* `GEAR_LIBRARY`
      - **ğŸ“„ packs.ts**
          - *Exports:* `PACK_LIBRARY`
      - **ğŸ“„ tools.ts**
          - *Exports:* `TOOL_LIBRARY`
      - **ğŸ“„ treasures.ts**
          - *Exports:* `TREASURE_LIBRARY`
      - **ğŸ“„ weapons.ts**
          - *Exports:* `WEAPON_LIBRARY`
    - **ğŸ“‚ rules/**
      - **ğŸ“„ conditions.ts**
          - *Exports:* `ConditionKey, ConditionDef, CONDITIONS, CONDITION_OPTIONS`
      - **ğŸ“„ currency.ts**
          - *Exports:* `CurrencyUnit, CURRENCY_RATES, toCopper`
      - **ğŸ“„ damageTypes.ts**
          - *Exports:* `DamageTypeKey, DamageTypeDef, DAMAGE_TYPES, DAMAGE_TYPE_OPTIONS`
      - **ğŸ“„ dndRules.ts**
          - *Exports:* `SKILL_DEFINITIONS, PROFICIENCY_LEVEL`
      - **ğŸ“„ proficiencies.ts**
          - *Exports:* `ARMOR_PROFICIENCIES, WEAPON_PROFICIENCIES, TOOL_PROFICIENCIES, COMMON_LANGUAGES, WEAPON_CAT_MAP, ARMOR_TYPE_MAP`
      - **ğŸ“„ weaponProperties.ts**
          - *Exports:* `WeaponPropertyDef, WEAPON_PROPERTIES`
    - **ğŸ“‚ spells/**
      - **ğŸ“„ cantrips.ts**
          - *Exports:* `CANTRIPS`
      - **ğŸ“„ index.ts**
          - *Exports:* `SPELL_LIBRARY, getSpellById, getSpellsByLevel`
      - **ğŸ“„ level1.ts**
          - *Exports:* `LEVEL_1_SPELLS`
      - **ğŸ“„ level2.ts**
          - *Exports:* `LEVEL_2_SPELLS`
      - **ğŸ“„ level3.ts**
          - *Exports:* `LEVEL_3_SPELLS`
      - **ğŸ“„ level4.ts**
          - *Exports:* `LEVEL_4_SPELLS`
      - **ğŸ“„ level5.ts**
          - *Exports:* `LEVEL_5_SPELLS`
      - **ğŸ“„ level6.ts**
          - *Exports:* `LEVEL_6_SPELLS`
      - **ğŸ“„ level7.ts**
          - *Exports:* `LEVEL_7_SPELLS`
      - **ğŸ“„ level8.ts**
          - *Exports:* `LEVEL_8_SPELLS`
      - **ğŸ“„ level9.ts**
          - *Exports:* `LEVEL_9_SPELLS`
    - **ğŸ“„ basicItems.ts**
        - *Exports:* `basicItems`
  - **ğŸ“‚ directives/**
    - **ğŸ“„ vTooltip.ts**
        - *Exports:* `vTooltip`
  - **ğŸ“‚ stores/**
    - **ğŸ“„ activeSheet.ts**
        - *Store ID:* `activeSheet`
        - *State:*
          - `character /* âœ… ä¸å†éœ€è¦ ExtendedCharacterï¼Œç›´æ¥ç”¨ Character */`
          - `trash /* é¡µé¢åˆ·æ–°/å…³é—­åï¼ŒStore é‡ç½®ï¼Œè¿™é‡Œè‡ªç„¶å°±æ¸…ç©ºäº† */`
          - `ui`
          - `isSpellbookOpen`
        - *Getters:*
          - `allKnownSpells /* ========================================== */`
          - `spellbookGroups`
          - `battleSpells /* ========================================== */`
          - `battleGroups`
          - `spellAbilityMod /* 1. æ–½æ³•å…³é”®å±æ€§è°ƒæ•´å€¼ */`
          - `calculatedSpellSaveDC /* 2. æ³•æœ¯è±å… DC (8 + PB + Mod) */`
          - `calculatedSpellAttackMod /* 3. æ³•æœ¯æ”»å‡»åŠ å€¼ (PB + Mod) */`
          - `mySpells /* 4. è·å–â€œå·²å‡†å¤‡/å·²çŸ¥â€çš„æ³•æœ¯åˆ—è¡¨ (æŒ‰ ID æ˜ å°„å›å¯¹è±¡) */`
          - `groupedSpells /* è¿”å›ç»“æ„ï¼š[ { level: 0, label: 'æˆæ³•', spells: [], slots: null }, { level: 1, ... } ] */`
          - `totalWeight /* 1. æ€»è´Ÿé‡ (é€»è¾‘ä¸å˜) */`
          - `getItemWeight /* é€’å½’è®¡ç®—ç‰©å“é‡é‡ (ä¿®æ”¹ï¼šè°ƒç”¨çº¯å‡½æ•°) */`
          - `totalInventoryWeight /* è®¡ç®—æ€»è´Ÿé‡ (ä¿®æ”¹ï¼šåŸºäºæ ¹èŠ‚ç‚¹é€’å½’) */`
          - `carryingCapacity /* è§„åˆ™ï¼šåŠ›é‡ * 15 (lb) */`
          - `armorClass`
          - `initiative /* ã€æ–°å¢ã€‘å…ˆæ”» (Initiative) */`
          - `attacks /* âœ… 4. æ”»å‡»é¢æ¿ (æ ¸å¿ƒä¿®æ”¹ï¼šæ¥å…¥ç†Ÿç»ƒåº¦è®¡ç®—) */`
          - `proficiencyBonus /* --- æ–°å¢ï¼šç†Ÿç»ƒåŠ å€¼ (PB) --- */`
          - `isWearingNonProficientArmor /* è¿”å› true è¡¨ç¤ºç©¿ç€äº†ä¸ç†Ÿç»ƒçš„æŠ¤ç”² */`
          - `for`
          - `skills /* --- æŠ€èƒ½åˆ—è¡¨è®¡ç®—å¼•æ“ --- */`
          - `passivePerception /* --- æ–°å¢ï¼šè¢«åŠ¨è§‰å¯Ÿ (Passive Perception) --- */`
          - `nextLevelXp /* --- æ–°å¢ï¼šå‡çº§æ‰€éœ€ç»éªŒå€¼ --- */`
          - `rootInventory /* åªæœ‰ parentId ä¸º undefined çš„ç‰©å“æ‰åº”è¯¥ç›´æ¥æ˜¾ç¤ºåœ¨é¡¶å±‚åˆ—è¡¨ */`
          - `getContainerContents /* è·å–æŸå®¹å™¨å†…çš„æ‰€æœ‰ç‰©å“ */`
        - *Actions:*
          - `âš™ï¸ learnSpell(spellId: string) ğŸ“ ç¡®ä¿æœ‰ learnSpell å’Œ togglePreparedSpell`
          - `âš™ï¸ togglePreparedSpell(spellId: string)`
          - `âš™ï¸ forgetSpell(spellId: string)`
          - `âš™ï¸ updateSpellSlot(level: number, newVal: number) ğŸ“ 1. æ¶ˆè€—/æ¢å¤æ³•æœ¯ä½`
          - `âš™ï¸ updateSpellSlotMax(level: number, newMax: number) ğŸ“ æ›´æ–°æ³•æœ¯ä½ä¸Šé™ (ç”¨äºæ³•æœ¯ä¹¦é…ç½®)`
          - `âš™ï¸ recoverAllSlots() ğŸ“ 2. é•¿ä¼‘ (æ¢å¤æ‰€æœ‰æ³•æœ¯ä½)`
          - `âš™ï¸ unprepareSpell(spellId: string) ğŸ“ å¼ºåˆ¶ç§»é™¤å‡†å¤‡`
          - `âš™ï¸ updateSpellConfig(path: string, value: any) ğŸ“ 6. æ›´æ–°æ–½æ³•èƒ½åŠ›é…ç½® (ä¿®æ”¹å±æ€§ã€DCã€æ³•æœ¯ä½ä¸Šé™ç­‰)`
          - `âš™ï¸ updateBio(field: keyof import('../types/Character') ğŸ“ æ›´æ–° Bio æ•°æ®çš„é€šç”¨æ–¹æ³•`
          - `âš™ï¸ toggleAttackMode(attr: AbilityKey) ğŸ“ [æ–°å¢] åˆ‡æ¢æ”»å‡»æ¨¡å¼å¼€å…³`
          - `âš™ï¸ loadCharacter(id: string) ğŸ“ è½½å…¥è§’è‰²æ—¶ï¼Œç¡®ä¿ equippedIds å­˜åœ¨`
          - `âš™ï¸ toggleProficiency(category: 'armor' | 'weapons', key: string) ğŸ“ category: 'armor' | 'weapons'`
          - `âš™ï¸ addProficiencyList(category: 'tools' | 'languages', val: string) ğŸ“ ä¿®å¤åçš„ Action: æ·»åŠ åˆ—è¡¨é¡¹ (å¢å¼ºäº†å¥å£®æ€§)`
          - `âš™ï¸ removeProficiencyList(category: 'tools' | 'languages', index: number) ğŸ“ âœ… æ–°å¢ Action: ç§»é™¤åˆ—è¡¨é¡¹`
          - `âš™ï¸ initWalletIfMissing() ğŸ“ è¾…åŠ©ï¼šç¡®ä¿é’±åŒ…å­˜åœ¨`
          - `âš™ï¸ modifyCurrency(type: keyof typeof CURRENCY_RATES, amount: number)`
          - `âš™ï¸ while(lowPoolCP < 0) ğŸ“ å€Ÿç”¨é«˜ä½æ±  (æ‰“æ•£ PP å˜æˆ GP/SP/CP)`
          - `âš™ï¸ while(highPoolPP < 0) ğŸ“ å€Ÿç”¨ä½ä½æ±  (ç”¨ GP å‡‘å‡º PP æ”¯ä»˜)`
          - `âš™ï¸ updateWallet(type: 'cp' | 'sp' | 'ep' | 'gp' | 'pp', value: number) ğŸ“ type å‚æ•°å¯¹åº” Wallet æ¥å£çš„ key ('cp', 'sp', 'gp', 'pp')`
          - `âš™ï¸ save()`
          - `âš™ï¸ _createNewItem(libraryId: string, quantity: number, parentId?: string, index?: number)`
          - `âš™ï¸ _addOrMerge(libraryId: string, quantity: number, targetParentId?: string)`
          - `âš™ï¸ _addPack(packId: string, index?: number, parentId?: string)`
          - `âš™ï¸ addItem(libraryId: string, index?: number, parentId?: string)`
          - `âš™ï¸ removeItem(instanceId: string)`
          - `âš™ï¸ moveItemToTrash(instanceId: string)`
          - `âš™ï¸ updateInventoryItem(newItem: InventoryItem) ğŸ“ æ›´æ–°èƒŒåŒ…ä¸­çš„æŸä¸ªç‰©å“å®ä¾‹`
          - `âš™ï¸ updateEquippedList(newIds: string[]) ğŸ“ ã€æ–°ã€‘æ›´æ–°è£…å¤‡æ åˆ—è¡¨`
          - `âš™ï¸ updateStat(statName: keyof Character['stats'], value: number) ğŸ“ æ›´æ–°å±æ€§ (ä¾‹å¦‚æŠŠ strength æ”¹æˆ 18)`
          - `âš™ï¸ toggleSkill(skillKey: string)`
          - `âš™ï¸ toggleSavingThrow(attrKey: string) ğŸ“ ã€æ–°å¢ã€‘åˆ‡æ¢è±å…ç†Ÿç»ƒåº¦`
          - `âš™ï¸ addExperience(amount: number) ğŸ“ ã€è°ƒè¯•ç‰ˆã€‘å¢åŠ  XP`
          - `âš™ï¸ updateProfile(field: string, value: any) ğŸ“ ã€æ–°å¢ã€‘æ›´æ–°è§’è‰²åŸºç¡€ä¿¡æ¯ (Profile) çš„é€šç”¨æ–¹æ³•`
          - `âš™ï¸ resetExperience() ğŸ“ é‡ç½® XP`
          - `âš™ï¸ applyDamage(amount: number) ğŸ“ 1. é€ æˆä¼¤å®³`
          - `âš™ï¸ applyHeal(amount: number) ğŸ“ 2. æ²»ç–—`
          - `âš™ï¸ fullHeal() ğŸ“ 3. ä¸€é”®å›æ»¡`
          - `âš™ï¸ setTempHp(amount: number) ğŸ“ 4. è®¾ç½®ä¸´æ—¶ç”Ÿå‘½ (è¦†ç›–æ¨¡å¼)`
          - `âš™ï¸ updateCombatStat(field: keyof Character['combat'], value: any) ğŸ“ 5. æ›´æ–°é€šç”¨æˆ˜æ–—æ•°å€¼ (é€Ÿåº¦, ç”Ÿå‘½éª°, çŠ¶æ€)`
          - `âš™ï¸ resetDeathSaves() ğŸ“ 6. é‡ç½®æ­»äº¡è±å…`
          - `âš™ï¸ toggleInspiration(index: number) ğŸ“ 7. åˆ‡æ¢æ¿€åŠ± (index: 0, 1, 2)`
          - `âš™ï¸ toggleAttackVisibility(derivedId: string) ğŸ“ ã€æ–°å¢ã€‘åˆ‡æ¢æ”»å‡»æ¡ç›®çš„æ˜¾éšçŠ¶æ€`
          - `âš™ï¸ emptyTrash() ğŸ“ ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªä¸“é—¨æ¸…ç©ºåƒåœ¾ç®±çš„æ–¹æ³•ï¼ˆå¯é€‰ï¼‰`
          - `âš™ï¸ _reinsertItem(item: any, index?: number) ğŸ“ [å†…éƒ¨åŠ©æ‰‹] å°†ç‰©å“ç‰©ç†ç§»åŠ¨åˆ°æ•°ç»„çš„æŒ‡å®šä½ç½®`
          - `âš™ï¸ moveItemToContainer(itemId: string, containerId: string, targetIndex?: number) ğŸ“ åŠ¨ä½œï¼šæŠŠç‰©å“æ”¾å…¥å®¹å™¨ (æ”¯æŒæŒ‡å®šä½ç½®)`
          - `âš™ï¸ moveItemToRoot(itemId: string, targetIndex?: number) ğŸ“ åŠ¨ä½œï¼šæŠŠç‰©å“ç§»åˆ°æ ¹ç›®å½• (æ”¯æŒæŒ‡å®šä½ç½®)`
          - `âš™ï¸ reorderItem(itemId: string, targetIndex: number) ğŸ“ âœ… æ–°å¢ï¼šåŒçº§æ’åº (åªæ”¹ä½ç½®ï¼Œä¸æ”¹ parentId)`
          - `âš™ï¸ updateItemQuantity(instanceId: string, delta: number) ğŸ“ âœ… ã€æ–°å¢ã€‘æ›´æ–°ç‰©å“æ•°é‡ (ç”¨äºç‚¹å‡» +/- æŒ‰é’®)`
          - `âš™ï¸ toggleSpellbook(isOpen: boolean)`
    - **ğŸ“„ characterStore.ts**
        - *Store ID:* `characterStore`
        - *State:*
          - `characterList`
          - `_characterCache`
          - `_filenameMap /* ğŸ†• æ–°å¢ï¼šç”¨äºè®°å½•è§’è‰²å½“å‰åœ¨ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶åï¼Œä»¥ä¾¿æ”¹åæ—¶åˆ é™¤æ—§æ–‡ä»¶ */`
        - *Actions:*
          - `âš™ï¸ init() ğŸ“ --- 1. åˆå§‹åŒ– ---`
          - `âš™ï¸ createNewCharacter() ğŸ“ --- 2. åˆ›å»ºæ–°è§’è‰² (ä¿®æ”¹ï¼šä¸å†è‡ªåŠ¨ä¿å­˜) ---`
          - `âš™ï¸ saveCharacterData(char: Character) ğŸ“ --- 3. ä¿å­˜é€»è¾‘ (æ ¸å¿ƒè¿ç§»é€»è¾‘) ---`
          - `âš™ï¸ getCharacterData(id: string) ğŸ“ --- 4. è¯»å– ---`
          - `âš™ï¸ deleteCharacter(id: string) ğŸ“ --- 5. åˆ é™¤é€»è¾‘ ---`
          - `âš™ï¸ exportCharacter(id: string) ğŸ“ --- 6. å¯¼å‡º ---`
          - `âš™ï¸ importCharacter(jsonStr: string) ğŸ“ --- 7. å¯¼å…¥ ---`
    - **ğŸ“„ tooltip.ts**
        - *Store ID:* `tooltip`
        - *State:*
          - `visible`
          - `data`
          - `x`
          - `y`
        - *Actions:*
          - `âš™ï¸ show(data: TooltipData, x: number, y: number)`
          - `âš™ï¸ hide()`
          - `âš™ï¸ updatePosition(x: number, y: number)`
  - **ğŸ“‚ types/**
    - **ğŸ“„ Character.ts**
        - *Exports:* `AbilityScores, Wallet, CharacterProficiencies, CharacterProfile, CharacterBio, CombatStats, CharacterSpells, Character`
    - **ğŸ“„ Item.ts**
        - *Exports:* `WeaponData, ArmorData, GearData, ToolData, ConsumableData, TreasureData, ContainerData, InventoryItem`
    - **ğŸ“„ Library.ts**
        - *Exports:* `ItemType, CurrencyUnit, AmmoTypeKey, AbilityKey, ItemCost, ItemDefinition, WeaponCategory, WeaponPropertyKey, WeaponDefinition, ArmorType`
    - **ğŸ“„ Spell.ts**
        - *Exports:* `SpellSchool, SpellAttackType, SpellComponents, SpellClassKey, SpellDefinition`
  - **ğŸ“‚ utils/**
    - **ğŸ“„ currencyUtils.ts**
        - *Exports:* `formatCost, toCopper, addCosts`
    - **ğŸ“„ idGenerator.ts**
        - *Exports:* `generateUUID`
    - **ğŸ“„ inventoryDropUtils.ts**
        - *Exports:* `getGlobalDragPayload, clearGlobalDragPayload, calcRealIndex, setupDragData`
    - **ğŸ“„ itemFactory.ts**
        - *Exports:* `createItemFromLibrary`
    - **ğŸ“„ spellUtils.ts**
        - *Exports:* `calculateCantripDamage`
  - **ğŸ“„ App.vue**
      - *Uses:* `useCharacterStore, useActiveSheetStore`
  - **ğŸ“„ vite-env.d.ts**
- **ğŸ“¦ electron/**
  - **ğŸ“„ main.ts**
  - **ğŸ“„ preload.ts**
